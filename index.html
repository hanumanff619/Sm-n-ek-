<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Směnářek</title>
  <meta name="theme-color" content="#102a4a">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon-192.png">

  <style>
    :root{
      --bg:#0c1d33; --panel:#122e52; --ink:#eaf2ff;
      --muted:#9fb6d4; --good:#5bd39a; --goodtext:#9ff3cd;
      --sel:#1e78d799; --accent:#b38cff;
    }
    html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
    *{box-sizing:border-box}
    header{position:sticky;top:0;z-index:5;background:linear-gradient(180deg,rgba(0,0,0,.4),rgba(0,0,0,.0));backdrop-filter:saturate(140%) blur(4px)}
    .head{display:flex;flex-direction:column;align-items:flex-start;gap:.5rem;padding:.7rem 1rem 0}
    .logo{font-size:2rem;line-height:1;font-weight:800;letter-spacing:.5px}
    .todayBox{width:100%;max-width:1200px;padding:.4rem 1rem .8rem;margin-inline:auto}
    .todayLine{color:var(--goodtext);font-weight:700;font-size:1.05rem}
    hr{border:none;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.12),transparent);margin:.9rem 0}
    main{max-width:1200px;margin:0 auto;padding:1rem}
    .grid{display:grid;grid-template-columns:1fr;gap:.9rem}
    @media (min-width:920px){ .grid{grid-template-columns:1fr 1fr} }
    .card{position:relative;background:var(--panel);border-radius:18px;box-shadow:0 6px 24px rgba(0,0,0,.28);overflow:hidden}
    .h3wrap{display:flex;align-items:center;gap:.6rem;padding:1rem 1rem .2rem}
    h3{margin:0;font-size:1.25rem}
    .info{position:absolute;top:10px;right:12px;left:auto;font-size:.9rem;opacity:.92;cursor:help}
    .info b{display:inline-grid;place-items:center;width:26px;height:26px;border-radius:8px;background:rgba(255,255,255,.15);color:#bfe1ff;border:1px solid rgba(255,255,255,.2)}
    .tooltip{position:absolute;right:12px;left:auto;top:36px;max-width:min(420px,90vw);background:#0d2038;border:1px solid rgba(255,255,255,.18);border-radius:12px;padding:.75rem .9rem;opacity:0;pointer-events:none;transform:translateY(-6px);transition:.18s ease}
    .info:hover .tooltip{opacity:1;pointer-events:auto;transform:translateY(0)}
    .row{display:flex;gap:.6rem;flex-wrap:wrap;align-items:center;padding:0 1rem 1rem}
    .chip{padding:.38rem .7rem;border:1px solid rgba(255,255,255,.2);border-radius:999px;background:rgba(255,255,255,.06)}
    label{display:block;margin:.45rem 0 .25rem}
    input,select,button,textarea{font:inherit;color:inherit}
    input[type=text],input[type=number]{width:100%;background:#0d223d;border:1px solid rgba(255,255,255,.18);border-radius:12px;padding:.7rem .8rem}
    .two{display:grid;grid-template-columns:1fr;gap:.6rem;padding:0 1rem 1rem}
    @media(min-width:720px){.two{grid-template-columns:1fr 1fr}}
    .result{margin:1rem;border-radius:14px;background:rgba(0,0,0,.2);padding:.8rem 1rem}
    .result.good{background:rgba(19,88,57,.35)}
    .result h4{margin:.15rem 0 .35rem}
    .subtle{color:var(--muted)}
    .hidden{display:none}
    /* kalendář */
    #card-calendar{position:relative;overflow:hidden}
    #bg-layer{position:absolute;inset:0;background-size:cover;background-position:center;filter:contrast(90%) brightness(80%) blur(0px);opacity:.42}
    #card-calendar > :not(#bg-layer){position:relative}
    table.calendar{width:100%;border-collapse:collapse}
    .calendar th{color:var(--muted);font-weight:600;text-align:center}
    .calendar td{height:92px;position:relative;background:rgba(0,0,0,.15);border:1px solid rgba(255,255,255,.06)}
    .calendar td.selected{background:var(--sel)!important}
    .calendar td.today:not(.selected){box-shadow:inset 0 0 0 2px var(--accent)}
    .daynum{position:absolute;top:.35rem;right:.35rem;color:rgba(255,255,255,.7);font-size:.9rem}
    .badge{display:inline-block;margin-top:1.2rem;padding:.22rem .45rem;border-radius:999px;font-weight:700}
    .D{background:linear-gradient(180deg,rgba(108,192,255,.25),rgba(108,192,255,.08))}
    .N{background:linear-gradient(180deg,rgba(255,184,104,.25),rgba(255,184,104,.08))}
    .V{background:linear-gradient(180deg,rgba(194,120,255,.25),rgba(194,120,255,.08))}
    .R{background:linear-gradient(180deg,rgba(108,192,255,.25),rgba(108,192,255,.08))}
    .O{background:linear-gradient(180deg,rgba(255,184,104,.25),rgba(255,184,104,.08))}
  </style>
</head>

<body>
<header>
  <div class="head">
    <div class="logo">Směnářek</div>
    <div class="todayBox">
      <div class="todayLine"><span data-i18n="today">Dnes:</span> <span id="todayShift">—</span></div>
      <div class="todayLine"><span data-i18n="nameday">Svátek:</span> <span id="todayName">—</span></div>
    </div>
  </div>
</header>

<main>
  <section id="card-calendar" class="card">
    <div id="bg-layer"></div>
    <div class="h3wrap">
      <h3 data-i18n="calendar">Kalendář</h3>
      <div class="info"><b>i</b>
        <div class="tooltip">
          <div><b data-i18n="cal_help_title">Jak zadávat směny</b></div>
          <div class="subtle" data-i18n="cal_help_text">
            Klepni na den pro cyklování (D/N/V/—). Dnešek je orámovaný. Dlouhé podržení den vymaže.
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <button class="chip" id="prevMonth">←</button>
      <div class="chip" id="monthLabel">—</div>
      <button class="chip" id="nextMonth">→</button>
      <button class="chip" id="goToday" data-i18n="today">Dnes</button>
      <button class="chip" id="clearDay" data-i18n="clear_day">Vymazat den</button>
    </div>

    <div class="row">
      <table id="calendar" class="calendar"></table>
    </div>
  </section>

  <!-- Nastavení – rozbalovací, JEDNA verze -->
  <div class="row" style="margin:.6rem 0 0;">
    <button id="toggleSettings" class="chip">⚙️ <span data-i18n="settings">Nastavení</span></button>
  </div>
  <section id="settingsPanel" class="card hidden">
    <div class="h3wrap">
      <h3 data-i18n="settings">Nastavení</h3>
      <div class="info"><b>i</b>
        <div class="tooltip">
          <div><b data-i18n="settings_help_title">Nastavení aplikace</b></div>
          <div class="subtle" data-i18n="settings_help_text">Režim směn, jazyk a měna se uloží do zařízení.</div>
        </div>
      </div>
    </div>

    <div class="row"><span class="chip" data-i18n="shift_mode">Režim směn:</span>
      <label class="chip"><input type="radio" name="shiftMode" id="mode12" value="12"> <span data-i18n="mode12">12 h (D/N/V)</span></label>
      <label class="chip"><input type="radio" name="shiftMode" id="mode8"  value="8"> <span data-i18n="mode8">8 h (R/O/N/V)</span></label>
    </div>
    <div class="row">
      <label class="chip" for="langSelect" data-i18n="language">Jazyk:</label>
      <select id="langSelect" class="chip">
        <option value="cs">Čeština</option><option value="en">English</option><option value="de">Deutsch</option>
      </select>
      <label class="chip" for="currencySelect" data-i18n="currency">Měna:</label>
      <select id="currencySelect" class="chip">
        <option value="CZK">Kč</option><option value="EUR">€</option><option value="USD">$</option>
      </select>
    </div>
  </section>

  <!-- Statistika měsíce -->
  <section class="card">
    <div class="h3wrap"><h3 data-i18n="month_stats">Statistiky měsíce</h3></div>
    <div class="row">
      <div class="subtle" data-i18n="legend">
        Obědy jen všední den při denní (12h: D; 8h: R). Dovolená = nastavené hodiny/den. Svátek: směna + průměr.
      </div>
    </div>
    <hr>
    <div class="row" id="monthStats"></div>
  </section>

  <!-- Mzda – vstupy -->
  <section class="card">
    <div class="h3wrap">
      <h3 data-i18n="wage_inputs">Mzda (vstupy)</h3>
      <div class="info"><b>i</b>
        <div class="tooltip">
          <div><b data-i18n="wage_help_title">Vysvětlení</b></div>
          <div class="subtle" data-i18n="wage_help_text">Cafeterie je mimo čistou mzdu. Prémie přímé v % se počítají z hodinové základny.</div>
        </div>
      </div>
    </div>

    <div class="two">
      <div><label data-i18n="base_rate">Základní hodinovka</label><input id="baseRate" type="number" min="0" step="1" placeholder=""></div>
      <div><label data-i18n="bonus_afternoon">Odpolední příplatek</label><input id="bonusAft" type="number" min="0" step="1" placeholder=""></div>
      <div><label data-i18n="bonus_night">Noční příplatek</label><input id="bonusNight" type="number" min="0" step="1" placeholder=""></div>
      <div><label data-i18n="bonus_weekend">Víkendový příplatek</label><input id="bonusWend" type="number" min="0" step="1" placeholder=""></div>
      <div><label data-i18n="bonus_cont">Nepřetržitý provoz</label><input id="bonusCont" type="number" min="0" step="1" placeholder=""></div>
      <div><label data-i18n="bonus_direct_pct">Přímé prémie (%)</label><input id="bonusPct" type="number" min="0" step="1" value="10"></div>
      <div style="grid-column:1/-1">
        <label><input id="cafCheck" type="checkbox"> <span data-i18n="caf_label">Docházkový bonus (Cafeterie 1000 Kč – mimo čistou)</span></label>
      </div>
      <div><label data-i18n="annual_bonus">Roční motivační (Kč)</label><input id="annualBonus" type="number" min="0" step="1" value="0"></div>
      <div><label data-i18n="vac_perday">Dovolená (hod/den)</label><input id="vacPerDay" type="number" min="0" step=".25" value="8"></div>
    </div>
  </section>

  <!-- Průměrná náhrada -->
  <section class="card">
    <div class="h3wrap">
      <h3 data-i18n="avg_comp_3m">Průměrná náhrada (poslední 3 měsíce)</h3>
      <div class="info"><b>i</b><div class="tooltip"><div><b data-i18n="avg_help_title">Jak počítat průměr</b></div><div class="subtle" data-i18n="avg_help_text">Zadej čisté mzdy a hodiny M-1, M-2, M-3 nebo vlož ručně průměr (Kč/h).</div></div></div>
    </div>
    <div class="two" id="avgForm">
      <div><label data-i18n="net_m1">Čistá mzda M-1</label><input id="netM1" type="number" step="1"></div>
      <div><label data-i18n="net_m2">Čistá mzda M-2</label><input id="netM2" type="number" step="1"></div>
      <div><label data-i18n="hrs_m1">Hodiny M-1</label><input id="hrsM1" type="number" step=".25"></div>
      <div><label data-i18n="hrs_m2">Hodiny M-2</label><input id="hrsM2" type="number" step=".25"></div>
      <div><label data-i18n="net_m3">Čistá mzda M-3</label><input id="netM3" type="number" step="1"></div>
      <div><label data-i18n="hrs_m3">Hodiny M-3</label><input id="hrsM3" type="number" step=".25"></div>
      <div style="grid-column:1/-1"><label data-i18n="avg_manual">Ručně zadaná průměrná náhrada (Kč/h)</label><input id="avgManual" type="number" step=".01"></div>
    </div>
    <div class="row"><div class="subtle" id="avgOut" data-i18n="avg_label">Průměrná náhrada:</div><div id="avgVal">&nbsp;0,00 Kč</div></div>
  </section>

  <!-- Výsledky -->
  <section class="card">
    <div class="result"><h4 data-i18n="gross">Hrubá mzda:</h4><div id="grossVal">0,00 Kč</div></div>
    <div class="result good"><h4 data-i18n="net_est">Čistá mzda (odhad):</h4><div id="netVal">0,00 Kč</div></div>
    <div class="result"><h4 data-i18n="meal_vouchers">Stravenky:</h4><div id="mealVal">0,00 Kč</div></div>
    <div class="result"><h4 data-i18n="cafeteria_out">Cafeterie (mimo čistou):</h4><div id="cafVal">0,00 Kč</div></div>
  </section>
</main>

<script src="app_v181.js"></script>
</body>
</html>
